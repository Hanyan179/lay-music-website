---
description: 
globs: 
alwaysApply: false
---

1 端口 & 环境变量
项目	端口	关键文件	说明
Vite Dev Server	3004	vite.config.ts → server.port & server.hmr.port	浏览器必须走 3004；禁止 3000
Spring Boot	8080	backend/src/main/resources/application.yml	仅导出静态 timeline.json
Env	VITE_API_BASE_URL=http://localhost:8080/api	.env.local	Axios 基址

2 路由规范（懒加载 · 三级跳）
路径	name	组件	作用
/	Home	Home.vue（或 ArtistJourney.vue）	站点首页
含按钮 进入 3D 时间轴 → /timeline-landing
/timeline-landing	TimelineLanding	TimelineLanding.vue	3D 首屏（全屏 Canvas3D + CTA）
点击 CTA → /timeline
/timeline	Timeline	TimelinePage.vue（包装 Timeline3D）	3D 卡片时间轴；BackTop 返回 /timeline-landing
/year/:year(\\d{4})	YearDetail	YearDetail.vue	年份详情；BackTop 返回 /timeline
/x-back	AdminLogin	AdminLogin.vue	后台登录
/x-back/dashboard	AdminDashboard	AdminDashboard.vue	后台仪表盘；meta.requiresAuth
其他	—	—	/:pathMatch(.*)* → /

懒加载写法
component: () => import('@/views/TimelinePage.vue')

3 目录结构（关键层）
bash
复制
编辑
src/
 ├─ views/
 │   ├─ Home.vue
 │   ├─ TimelineLanding.vue        # 3D 首屏
 │   ├─ TimelinePage.vue           # BackTop + Timeline3D
 │   ├─ Timeline3D.vue             # Swiper + ScrollTrigger + Canvas3D
 │   ├─ ArtistJourney.vue
 │   ├─ YearDetail.vue
 │   ├─ AdminLogin.vue
 │   └─ AdminDashboard.vue
 ├─ components/
 │   ├─ EnterButton.vue
 │   ├─ timeline/BackTop.vue
 │   └─ three/Canvas3D.vue
 ├─ router/index.ts
 ├─ store/timeline.ts
 ├─ api/axios.ts
 └─ …
public/database/
 ├─ timeline.json                  # 后端导出
 ├─ thumbs/                        # 小图
 └─ images/                        # 高清图
4 Three.js & GSAP 交互
场景	组件	关键点
全局渲染	components/three/Canvas3D.vue	FOV 45，camera.position (0,0,80)；resize；粒子示例
首页视差	TimelineLanding.vue	pointermove → 相机轻微 yaw/pitch
时间轴滚动	Timeline3D.vue	ScrollTrigger：pin+scrub; snap=1/(yearCount-1); 相机 z 80→35
详情页	YearDetail.vue	静态 UI（如网格大图）；无 3D 动画

5 静态数据
文件 public/database/timeline.json

json
复制
编辑
[
  {
    "year": 2020,
    "events": [
      {
        "id": "e2020-1",
        "title": "发行专辑",
        "imagePath": "/database/images/2020_album.webp",
        "timestamp": "2020-10-15"
      }
    ]
  }
]
Pinia timeline store：

years 数组

ensureLoaded() 懒加载 json（带缓存）

图片双通道：thumbs/ 列表用；images/ 详情页用；全部 WebP/AVIF + lazy。

6 样式守则
项目	规则
TailwindCSS	全局启用；自定义渐变、阴影用 @apply
禁止永久锁滚	只能在组件 onMounted 设置 body.style.overflow='hidden'，在 onUnmounted 清空
FPS 目标	桌面 ≥ 30 fps，优先压缩纹理、降低粒子数

7 “同步档”机制（协作必备）
每次提交/讨论前请刷新并发送：

docs/PROJECT_TREE.md —— pnpm run gen:tree 生成第 3 层目录树

docs/ROUTES.md —— 按上表更新

docs/CONFIG_PORTS.md —— 端口 & env 一览

前端 package.json 中 dependencies + devDependencies 片段

后端 pom.xml 中 <dependencies> 片段（若有改动）

8 脚本
jsonc
复制
编辑
// package.json
{
  "scripts": {
    "dev": "vite",                 // 打开 3004
    "gen:tree": "npx tree -I 'node_modules|dist|logs|.git|.idea|target' -L 3 -F --dirsfirst > docs/PROJECT_TREE.md"
  }
}
9 常见坑 & 处理
问题	解决方案
浏览器仍 ping 3000	再次确认 vite.config.ts server.hmr.port=3004; 关闭旧标签
返回首页后滚轮失效	确认未残留全局 CSS body{overflow:hidden}；用生命周期恢复
模块路径报错	tsconfig.json paths 与目录别名 @ 一致；重启 Vite